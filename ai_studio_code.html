<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoverse - 깔쌈한 메모장</title>
    <!-- Tailwind CSS (디자인용) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (나눔스퀘어네오 등 폰트) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f3f4f6;
        }
        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
        
        /* 이미지 미리보기 영역 스타일 */
        .image-preview {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 24 24' fill='none' stroke='%23cbd5e1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Ccircle cx='8.5' cy='8.5' r='1.5'%3E%3C/circle%3E%3Cpolyline points='21 15 16 10 5 21'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- 네비게이션 -->
    <nav class="fixed top-0 w-full bg-white/80 backdrop-blur-md border-b border-slate-200 z-40 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">M</div>
                <span class="text-xl font-bold tracking-tight text-slate-900">Memoverse</span>
            </div>
            <button onclick="openModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-full text-sm font-medium transition-all shadow-lg shadow-indigo-200 transform hover:-translate-y-0.5 flex items-center gap-2">
                <i class="fa-solid fa-plus"></i> 새 메모
            </button>
        </div>
    </nav>

    <!-- 메인 컨텐츠 -->
    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-6xl mx-auto min-h-screen">
        <!-- 메모 리스트 영역 -->
        <div id="memo-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- 자바스크립트로 메모 카드가 여기에 렌더링 됩니다 -->
        </div>

        <!-- 빈 상태 메시지 -->
        <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-slate-400">
            <i class="fa-regular fa-note-sticky text-6xl mb-4 text-slate-300"></i>
            <p class="text-lg">작성된 메모가 없습니다.</p>
            <p class="text-sm">우측 상단 버튼을 눌러 기록을 시작해보세요.</p>
        </div>
    </main>

    <!-- 모달 (작성/수정) -->
    <div id="memo-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <!-- 배경 딤처리 -->
        <div class="fixed inset-0 bg-slate-900/30 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>

        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                
                <!-- 모달 패널 -->
                <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg border border-slate-100">
                    
                    <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold leading-6 text-slate-900 mb-4" id="modal-title">새로운 메모</h3>
                            
                            <!-- 제목 입력 -->
                            <div>
                                <label for="title" class="block text-sm font-medium leading-6 text-slate-500 mb-1">제목</label>
                                <input type="text" id="input-title" class="block w-full rounded-md border-0 py-2.5 px-3 text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 bg-slate-50 transition-colors" placeholder="제목을 입력하세요">
                            </div>

                            <!-- 내용 입력 -->
                            <div>
                                <label for="content" class="block text-sm font-medium leading-6 text-slate-500 mb-1">내용</label>
                                <textarea id="input-content" rows="4" class="block w-full rounded-md border-0 py-2.5 px-3 text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 bg-slate-50 resize-none transition-colors" placeholder="무슨 생각을 하고 계신가요?"></textarea>
                            </div>

                            <!-- 이미지 업로드 -->
                            <div>
                                <label class="block text-sm font-medium leading-6 text-slate-500 mb-1">사진 첨부</label>
                                <div class="flex items-center gap-4">
                                    <label for="input-image" class="cursor-pointer inline-flex items-center gap-2 rounded-md bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 hover:bg-slate-50">
                                        <i class="fa-regular fa-image text-indigo-600"></i> 파일 선택
                                        <input id="input-image" type="file" accept="image/*" class="sr-only" onchange="handleImageUpload(this)">
                                    </label>
                                    <span id="file-name" class="text-xs text-slate-400 truncate max-w-[150px]">선택된 파일 없음</span>
                                </div>
                                <!-- 미리보기 -->
                                <div id="preview-container" class="mt-3 hidden relative group">
                                    <img id="image-preview" src="" alt="Preview" class="w-full h-48 object-cover rounded-lg border border-slate-200">
                                    <button onclick="removeImage()" class="absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white rounded-full p-1.5 w-8 h-8 flex items-center justify-center transition-colors">
                                        <i class="fa-solid fa-xmark"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 하단 버튼 -->
                    <div class="bg-slate-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 gap-2">
                        <button type="button" onclick="saveMemo()" class="inline-flex w-full justify-center rounded-lg bg-indigo-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 sm:w-auto transition-colors">저장하기</button>
                        <button type="button" onclick="closeModal()" class="mt-3 inline-flex w-full justify-center rounded-lg bg-white px-5 py-2.5 text-sm font-semibold text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 hover:bg-slate-50 sm:mt-0 sm:w-auto transition-colors">취소</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 상태 관리 ---
        let memos = JSON.parse(localStorage.getItem('memos')) || [];
        let editingId = null;
        let currentImageBase64 = null;

        const modal = document.getElementById('memo-modal');
        const grid = document.getElementById('memo-grid');
        const emptyState = document.getElementById('empty-state');

        // --- 초기화 ---
        document.addEventListener('DOMContentLoaded', renderMemos);

        // --- 기능 로직 ---

        // 모달 열기
        function openModal(id = null) {
            editingId = id;
            const titleInput = document.getElementById('input-title');
            const contentInput = document.getElementById('input-content');
            const modalTitle = document.getElementById('modal-title');
            
            // 초기화
            titleInput.value = '';
            contentInput.value = '';
            removeImage();

            if (id) {
                // 수정 모드
                const memo = memos.find(m => m.id === id);
                if (memo) {
                    modalTitle.innerText = '메모 수정';
                    titleInput.value = memo.title;
                    contentInput.value = memo.content;
                    if (memo.image) {
                        currentImageBase64 = memo.image;
                        document.getElementById('image-preview').src = memo.image;
                        document.getElementById('preview-container').classList.remove('hidden');
                        document.getElementById('file-name').innerText = "기존 이미지 유지";
                    }
                }
            } else {
                // 신규 모드
                modalTitle.innerText = '새로운 메모';
            }

            modal.classList.remove('hidden');
        }

        // 모달 닫기
        function closeModal() {
            modal.classList.add('hidden');
            editingId = null;
        }

        // 이미지 처리 (Base64 변환)
        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                document.getElementById('file-name').innerText = file.name;

                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageBase64 = e.target.result;
                    document.getElementById('image-preview').src = currentImageBase64;
                    document.getElementById('preview-container').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        // 이미지 삭제
        function removeImage() {
            currentImageBase64 = null;
            document.getElementById('input-image').value = ''; // input 초기화
            document.getElementById('preview-container').classList.add('hidden');
            document.getElementById('file-name').innerText = '선택된 파일 없음';
        }

        // 메모 저장
        function saveMemo() {
            const title = document.getElementById('input-title').value.trim();
            const content = document.getElementById('input-content').value.trim();

            if (!title && !content && !currentImageBase64) {
                alert('내용을 입력해주세요!');
                return;
            }

            const now = new Date().toLocaleString('ko-KR', {
                year: '2-digit', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit'
            });

            if (editingId) {
                // 수정
                const index = memos.findIndex(m => m.id === editingId);
                if (index !== -1) {
                    memos[index] = { ...memos[index], title, content, image: currentImageBase64, date: now };
                }
            } else {
                // 신규 생성
                const newMemo = {
                    id: Date.now(),
                    title,
                    content,
                    image: currentImageBase64,
                    date: now
                };
                memos.unshift(newMemo); // 최신순 정렬
            }

            saveToLocal();
            renderMemos();
            closeModal();
        }

        // 메모 삭제
        function deleteMemo(id, event) {
            event.stopPropagation(); // 카드 클릭 이벤트 방지
            if(confirm('정말 삭제하시겠습니까?')) {
                memos = memos.filter(m => m.id !== id);
                saveToLocal();
                renderMemos();
            }
        }

        // LocalStorage 저장
        function saveToLocal() {
            localStorage.setItem('memos', JSON.stringify(memos));
        }

        // 화면 렌더링
        function renderMemos() {
            grid.innerHTML = '';

            if (memos.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');

            memos.forEach(memo => {
                const card = document.createElement('div');
                // 카드 스타일
                card.className = 'bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition-all duration-300 cursor-pointer hover:-translate-y-1 flex flex-col group';
                card.onclick = () => openModal(memo.id);

                // 이미지 영역
                let imageHtml = '';
                if (memo.image) {
                    imageHtml = `<div class="h-48 w-full bg-slate-100 overflow-hidden">
                                    <img src="${memo.image}" alt="Memo Image" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                                 </div>`;
                }

                // 내용 영역
                card.innerHTML = `
                    ${imageHtml}
                    <div class="p-5 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-lg font-bold text-slate-900 line-clamp-1">${memo.title || '제목 없음'}</h3>
                        </div>
                        <p class="text-slate-600 text-sm line-clamp-3 mb-4 flex-1 whitespace-pre-wrap">${memo.content || ''}</p>
                        
                        <div class="flex items-center justify-between mt-auto pt-3 border-t border-slate-100">
                            <span class="text-xs text-slate-400">${memo.date}</span>
                            <div class="flex gap-2">
                                <button onclick="deleteMemo(${memo.id}, event)" class="text-slate-400 hover:text-red-500 p-1 transition-colors" title="삭제">
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
    </script>
</body>
</html>